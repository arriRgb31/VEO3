<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>VEO3 Lab</title>
<meta name="viewport" content="width=device-width">

<style>
body{background:#0b0b12;color:#eee;font-family:system-ui;padding:16px}
textarea,select,button{width:100%;margin-top:10px;padding:10px}
button{background:#5b5cff;color:white;font-weight:bold}
video,img{width:100%;margin-top:12px}
pre{background:#141420;padding:12px}
</style>
</head>

<body>

<h3>VEO3 Experimental Lab</h3>

<select id="mode">
  <option value="txt2img">Text → Image</option>
  <option value="txt2vid">Text → Video</option>
</select>

<textarea id="prompt" rows="4" placeholder="Prompt..."></textarea>

<button onclick="generate()">Generate</button>

<pre id="log"></pre>
<div id="result"></div>

<script>
const API = "https://veo3.arxxcc.workers.dev";

async function generate(){
  log.textContent = "Submitting...";
  result.innerHTML = "";

  const r = await fetch(API + "/generate", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      mode: mode.value,
      prompt: prompt.value
    })
  });

  const { id } = await r.json();
  poll(id);
}

async function poll(id){
  while(true){
    const r = await fetch(API + "/status?id=" + id);
    const data = await r.json();

    log.textContent = data.status;

    if(data.status === "succeeded"){
      const out = data.output[0];
      if(out.endsWith(".mp4")){
        result.innerHTML = `
          <video src="${out}" controls></video>
          <a href="${out}" download>Download video</a>
        `;
      } else {
        result.innerHTML = `<img src="${out}">`;
      }
      break;
    }

    if(data.status === "failed"){
      log.textContent = "Failed";
      break;
    }

    await new Promise(r=>setTimeout(r,3000));
  }
}
</script>

</body>
</html>
